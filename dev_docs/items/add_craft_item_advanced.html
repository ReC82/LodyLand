<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Documentation â€” Craft avancÃ© (LodyLand)</title>
<style>
  body {
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f7f7fb;
    line-height: 1.6;
    color: #333;
  }

  header {
    background: #334155;
    color: white;
    padding: 2rem 1rem;
    text-align: center;
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  }

  h1 {
    margin: 0;
    font-size: 2rem;
  }

  h2 {
    margin-top: 2rem;
    color: #1f2937;
  }

  h3 {
    margin-top: 1.5rem;
    color: #374151;
  }

  .container {
    max-width: 980px;
    margin: 0 auto;
    padding: 2rem;
  }

  pre {
    background: #111827;
    color: #e5e7eb;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 0.9rem;
  }

  code {
    background: #e5e7eb;
    padding: 2px 4px;
    border-radius: 4px;
  }

  ul {
    margin-left: 1.2rem;
  }

  .box {
    background: white;
    padding: 1.2rem 1.4rem;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.09);
    margin-bottom: 2rem;
  }

  .important {
    background: #fef3c7;
    border-left: 5px solid #f59e0b;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 5px;
  }

  .tip {
    background: #e0f2fe;
    border-left: 5px solid #3b82f6;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 5px;
  }

  .toc a {
    text-decoration: none;
    color: #1d4ed8;
  }

  .toc a:hover {
    text-decoration: underline;
  }
</style>
</head>

<body>

<header>
  <h1>Craft avancÃ© â€” Recettes, tables et mÃ©caniques (LodyLand)</h1>
</header>

<div class="container">

<div class="box toc">
  <h2>ğŸ“š Table des matiÃ¨res</h2>
  <ul>
    <li><a href="#overview">0. Rappel rapide du systÃ¨me de base</a></li>
    <li><a href="#tables">1. GÃ©rer plusieurs tables de craft</a></li>
    <li><a href="#levels">2. Niveaux de table & recettes avancÃ©es</a></li>
    <li><a href="#patterns">3. Patterns 3Ã—3 et Ã©volutions de lâ€™UI</a></li>
    <li><a href="#shapeless">4. Recettes Â« shapeless Â» (ordre libre)</a></li>
    <li><a href="#unlock">5. Conditions de dÃ©blocage (cartes, niveaux, quÃªtes)</a></li>
    <li><a href="#outputs">6. QuantitÃ© produite & sous-produits</a></li>
    <li><a href="#balance">7. Balancer les coÃ»ts, temps de craft & XP</a></li>
    <li><a href="#debug">8. Debug & bonnes pratiques</a></li>
    <li><a href="#checklist">9. Checklist craft avancÃ©</a></li>
  </ul>
</div>

<!-- ==================== 0. OVERVIEW ==================== -->
<div class="box" id="overview">
  <h2>0. ğŸ§  Rappel rapide du systÃ¨me de base</h2>

  <ul>
    <li>Les items craftables sont dÃ©finis dans <code>app/data/craft.yml</code>, section <code>items:</code>.</li>
    <li>Chaque item contient un bloc <code>recipe:</code> avec :
      <ul>
        <li><code>craft_location</code> (ex : <code>craft_table</code>)</li>
        <li><code>kind</code> (pour lâ€™instant <code>shaped</code>)</li>
        <li><code>pattern</code> / <code>legend</code></li>
        <li><code>output_quantity</code>, <code>craft_time_seconds</code>, <code>required_table_level</code></li>
      </ul>
    </li>
    <li>Le backend expose les recettes via <code>/api/craft/recipes?location=craft_table</code>.</li>
    <li>Lâ€™UI :
      <ul>
        <li>affiche les recettes dans le popup via ğŸ“–,</li>
        <li>dÃ©codage du pattern â†’ slots attendus,</li>
        <li>drag &amp; drop des ingrÃ©dients depuis lâ€™inventaire, validation avant craft.</li>
      </ul>
    </li>
  </ul>

  <div class="important">
    Ã€ ce stade, la table de craft de base fonctionne avec <strong>3 slots sur une ligne</strong>  
    (<code>width: 3</code>, <code>height: 1</code>).  
    Cette page explique comment aller plus loin (nouvelles tables, 3Ã—3, shapeless, etc.),  
    mÃªme si tout nâ€™est pas encore implÃ©mentÃ© dans lâ€™UI.
  </div>
</div>

<!-- ==================== 1. TABLES ==================== -->
<div class="box" id="tables">
  <h2>1. ğŸ§ª GÃ©rer plusieurs tables de craft</h2>

  <p>LodyLand pourra gÃ©rer plusieurs Â« stations Â» de craft :</p>
  <ul>
    <li><code>craft_table</code> : table de base (outils simples, matÃ©riaux bruts).</li>
    <li><code>alchemy_table</code> : potions, buffs, consommables.</li>
    <li><code>firepit</code> : cuisson, grillades, transformation dâ€™aliments.</li>
    <li><code>kitchen</code> : recettes complexes de cuisine.</li>
    <li>â€¦ et dâ€™autres Ã  venir (forge, laboratoire, etc.).</li>
  </ul>

  <p>Dans le YAML, Ã§a se dÃ©clare simplement :</p>

  <pre>
recipe:
  craft_location: "alchemy_table"
  kind: "shaped"
  width: 3
  height: 1
  ...
  </pre>

  <p>CÃ´tÃ© backend :</p>
  <ul>
    <li><code>/api/craft/recipes?location=alchemy_table</code> retourne uniquement les recettes compatibles avec cette table.</li>
    <li>Le joueur doit possÃ©der la bonne <strong>carte de station</strong> (ex. carte Â« Alchemy Table Â») pour y accÃ©der.</li>
  </ul>

  <div class="tip">
    Design futur : chaque table aura son propre bouton dans lâ€™UI (ex : ğŸ”¨ forge, âš—ï¸ alchimie, ğŸ³ cuisine),  
    ou sera accessible via un onglet dans le popup de craft.
  </div>
</div>

<!-- ==================== 2. TABLE LEVELS ==================== -->
<div class="box" id="levels">
  <h2>2. ğŸ“ˆ Niveaux de table & recettes avancÃ©es</h2>

  <p>Chaque recipe peut spÃ©cifier un <code>required_table_level</code> :</p>

  <pre>
recipe:
  craft_location: "craft_table"
  ...
  required_table_level: 3
  </pre>

  <p>Principe :</p>
  <ul>
    <li><strong>Niveau de table</strong> stockÃ© cÃ´tÃ© joueur (ex: dans <code>/api/state.craft.craft_table_level</code>).</li>
    <li>Le backend filtre les recettes :
      <ul>
        <li>recettes visibles â‰¥ niveau de table,</li>
        <li>ou recettes visibles mais non craftables avec un indicateur â€œverrouillÃ©â€.</li>
      </ul>
    </li>
  </ul>

  <p>IdÃ©es dâ€™Ã©volution :</p>
  <ul>
    <li>Une carte Â« Craft Table Upgrade I/II/III Â» qui augmente <code>craft_table_level</code>.</li>
    <li>Chaque niveau dÃ©bloque :
      <ul>
        <li>plus de slots (ex. 3 â†’ 6 â†’ 9),</li>
        <li>de nouvelles catÃ©gories dâ€™items.</li>
      </ul>
    </li>
  </ul>

  <div class="important">
    Quand tu passeras Ã  une table 3Ã—3, pense Ã  :
    <ul>
      <li>mettre Ã  jour le YAML (ex. <code>width: 3</code>, <code>height: 3</code>),</li>
      <li>adapter le code <code>decodeRecipeIntoSlots</code> et lâ€™UI pour gÃ©rer 9 slots au lieu de 3.</li>
    </ul>
  </div>
</div>

<!-- ==================== 3. PATTERNS 3x3 ==================== -->
<div class="box" id="patterns">
  <h2>3. ğŸ§© Patterns 3Ã—3 et extension de lâ€™UI</h2>

  <p>Un pattern 3Ã—3 ressemble au collier de perles dÃ©jÃ  dÃ©fini :</p>

  <pre>
recipe:
  craft_location: "craft_table"
  kind: "shaped"
  width: 5
  height: 5

  pattern:
    - "....."
    - ".ppp."
    - ".pgp."
    - ".ppp."
    - "....."

  legend:
    p:
      type: "resource"
      key: "pearl"
      quantity: 1
    g:
      type: "resource"
      key: "gold_ingot"
      quantity: 1
  </pre>

  <p>Pour une table 3Ã—3 classique, tu utiliseras plutÃ´t :</p>

  <pre>
recipe:
  craft_location: "craft_table"
  kind: "shaped"
  width: 3
  height: 3

  pattern:
    - "wb."
    - "vb."
    - "..b"

  legend:
    w: { type: "resource", key: "wood",  quantity: 1 }
    b: { type: "resource", key: "branch", quantity: 1 }
    v: { type: "resource", key: "vine",  quantity: 1 }
  </pre>

  <p>Ã‰volutions Ã  prÃ©voir cÃ´tÃ© code :</p>
  <ul>
    <li><strong>Backend</strong> : dÃ©jÃ  OK, le pattern complet est chargÃ© depuis YAML.</li>
    <li><strong>Frontend</strong> :
      <ul>
        <li>Adapter <code>decodeRecipeIntoSlots</code> pour lire chaque <code>row</code> et chaque colonne.</li>
        <li>Passer de 3 slots Ã  9 slots (grille CSS 3Ã—3).</li>
        <li>Associer les indices (0â€“8) aux positions du pattern (x, y).</li>
      </ul>
    </li>
  </ul>

  <div class="tip">
    Tu peux garder lâ€™implÃ©mentation actuelle (ligne de 3) comme <strong>niveau 1</strong>  
    et dÃ©bloquer la version 3Ã—3 Ã  partir dâ€™un certain <code>craft_table_level</code> ou dâ€™une carte dâ€™upgrade.
  </div>
</div>

<!-- ==================== 4. SHAPELESS ==================== -->
<div class="box" id="shapeless">
  <h2>4. ğŸŒ€ Recettes Â« shapeless Â» (ordre libre)</h2>

  <p>Une recette <code>shaped</code> impose une forme prÃ©cise dans la grille.  
  Parfois tu voudras simplement dire : Â« 3 lianes nâ€™importe oÃ¹ Â».</p>

  <p>Exemple de recette <strong>shapeless</strong> (concept, Ã  implÃ©menter plus tard) :</p>

  <pre>
recipe:
  craft_location: "craft_table"
  kind: "shapeless"

  ingredients:
    - type: "resource"
      key: "vine"
      quantity: 3

  output_quantity: 1
  craft_time_seconds: 3
  required_table_level: 1
  </pre>

  <p>Ã€ implÃ©menter cÃ´tÃ© backend :</p>
  <ul>
    <li>pour <code>kind == "shapeless"</code>, ignorer <code>pattern</code> et <code>legend</code>,</li>
    <li>compter les ressources dans lâ€™inventaire global du joueur,</li>
    <li>ne pas imposer de positions exactes dans la grille.</li>
  </ul>

  <p>Ã€ implÃ©menter cÃ´tÃ© UI :</p>
  <ul>
    <li>soit pas de drag &amp; drop (juste un check sur les quantitÃ©s),</li>
    <li>soit une zone Â« sac Â» dans laquelle le joueur jette les ingrÃ©dients sans pattern.</li>
  </ul>

  <div class="important">
    Pour lâ€™instant, reste sur des <code>kind: "shaped"</code>  
    afin de rester compatible avec la version actuelle de lâ€™UI.
  </div>
</div>

<!-- ==================== 5. UNLOCK CONDITIONS ==================== -->
<div class="box" id="unlock">
  <h2>5. ğŸ”“ Conditions de dÃ©blocage (cartes, niveaux, quÃªtes)</h2>

  <p>Chaque item peut dÃ©finir une condition de dÃ©blocage :</p>

  <pre>
unlock_condition:
  type: "card"        # "card", "level", "quest", "flag", ...
  key: "craft_jewelry_1"
  </pre>

  <p>Exemples dâ€™usages :</p>
  <ul>
    <li><code>type: "card"</code> : le joueur doit possÃ©der une carte spÃ©cifique incluse dans lâ€™inventaire de cartes.</li>
    <li><code>type: "level"</code> : dÃ©bloquer certains crafts Ã  partir dâ€™un niveau de joueur.</li>
    <li><code>type: "quest"</code> : recette accessible aprÃ¨s avoir terminÃ© une quÃªte donnÃ©e.</li>
  </ul>

  <p>Backend (concept) :</p>
  <ul>
    <li>Lors de la construction de la liste des recettes pour <code>/api/craft/recipes</code>, filtrer ou marquer les recettes en fonction de <code>unlock_condition</code> et de lâ€™Ã©tat du joueur.</li>
  </ul>

  <p>UI (idÃ©e) :</p>
  <ul>
    <li>Afficher les recettes verrouillÃ©es en gris avec un petit cadenas ğŸ”’.</li>
    <li>Afficher un tooltip Â« DÃ©bloquÃ© au niveau 5 Â», Â« NÃ©cessite carte : Craft Base Â», etc.</li>
  </ul>
</div>

<!-- ==================== 6. OUTPUTS ==================== -->
<div class="box" id="outputs">
  <h2>6. ğŸ“¦ QuantitÃ© produite & sous-produits</h2>

  <p>Actuellement, chaque recette dÃ©finit :</p>

  <pre>
output_quantity: 1
  </pre>

  <p>IdÃ©es dâ€™extensions :</p>
  <ul>
    <li>Produire plus dâ€™un item Ã  la fois (ex: 3 cordes pour 3Ã— lianes + 1 booster, etc.).</li>
    <li>Ajouter des sous-produits (ex: rÃ©sidus, objets de qualitÃ© variable).</li>
  </ul>

  <p>Exemple conceptuel avec sous-produits :</p>

  <pre>
recipe:
  ...
  output:
    main:
      key: "item_rope"
      quantity: 1
    byproducts:
      - key: "item_fiber"
        quantity: 1
        chance: 0.2   # 20% de chance
  </pre>

  <div class="tip">
    Le backend peut gÃ©rer Ã§a facilement, lâ€™UI devra simplement afficher les rÃ©sultats  
    (ex: â€œTu as craftÃ© 1 corde et tu as rÃ©cupÃ©rÃ© 1 fibre bonus !â€).
  </div>
</div>

<!-- ==================== 7. BALANCE ==================== -->
<div class="box" id="balance">
  <h2>7. âš–ï¸ Balancer coÃ»ts, temps de craft & XP</h2>

  <p>Pour garder le jeu intÃ©ressant :</p>

  <ul>
    <li><strong>CoÃ»t en ressources</strong> : plus un item est puissant / rare, plus il doit coÃ»ter cher.</li>
    <li><strong>Temps de craft</strong> (<code>craft_time_seconds</code>) :
      <ul>
        <li>items simples : 1â€“5s,</li>
        <li>items rares : 10â€“30s,</li>
        <li>objets trÃ¨s puissants : 30â€“60s ou plus.</li>
      </ul>
    </li>
    <li><strong>XP</strong> (Ã  connecter plus tard) :
      <ul>
        <li>chaque craft pourrait donner une quantitÃ© dâ€™XP en fonction du niveau de lâ€™item,</li>
        <li>cela alimente un â€œCrafting XPâ€ sÃ©parÃ© ou directement le niveau de joueur.</li>
      </ul>
    </li>
  </ul>

  <p>Tu peux prÃ©voir un champ futur :</p>

  <pre>
recipe:
  ...
  xp_reward: 5
  </pre>

  <div class="tip">
    Au dÃ©but, reste simple : 1 craft = 1 XP, puis affine avec un barÃ¨me plus tard  
    (ex: basÃ© sur la raretÃ© des ressources consommÃ©es).
  </div>
</div>

<!-- ==================== 8. DEBUG ==================== -->
<div class="box" id="debug">
  <h2>8. ğŸ› Debug & bonnes pratiques</h2>

  <h3>8.1. YAML ne se charge pas</h3>
  <ul>
    <li>VÃ©rifie la console au dÃ©marrage : <code>Loaded X craft item definitions</code>.</li>
    <li>Si le nombre ne change pas â†’ problÃ¨me dâ€™indentation ou de syntaxe YAML.</li>
    <li>VÃ©rifie que les nouveaux items sont bien sous <code>items:</code>, avec 2 espaces.</li>
  </ul>

  <h3>8.2. Recette non visible dans lâ€™UI</h3>
  <ul>
    <li>VÃ©rifie <code>/api/craft/recipes?location=craft_table</code>.</li>
    <li>Si lâ€™item nâ€™y apparaÃ®t pas :
      <ul>
        <li>checker <code>craft_location</code>,</li>
        <li>checker <code>required_table_level</code>,</li>
        <li>checker <code>unlock_condition</code> (si tu filtres cÃ´tÃ© backend).</li>
      </ul>
    </li>
  </ul>

  <h3>8.3. IcÃ´ne ne sâ€™affiche pas</h3>
  <ul>
    <li>VÃ©rifie lâ€™onglet Network (404 sur les PNG ?).</li>
    <li>VÃ©rifie le chemin dans <code>craft.yml</code> (ex: <code>static/assets/img/items/rope.png</code>).</li>
    <li>VÃ©rifie que le fichier est bien dans <code>app/static/assets/img/...</code>.</li>
  </ul>

  <h3>8.4. Drag &amp; drop ne valide pas le craft</h3>
  <ul>
    <li>VÃ©rifie le <code>pattern</code> et la <code>legend</code>.</li>
    <li>VÃ©rifie que les <code>key</code> des ressources dans la lÃ©gende correspondent Ã  celles des ressources (ex: <code>branch</code>, <code>vine</code>).</li>
    <li>VÃ©rifie que lâ€™UI lit bien la premiÃ¨re ligne si <code>height: 1</code>.</li>
  </ul>
</div>

<!-- ==================== 9. CHECKLIST ==================== -->
<div class="box" id="checklist">
  <h2>9. âœ… Checklist craft avancÃ©</h2>

  <ul>
    <li>Choisir la <strong>table</strong> (<code>craft_table</code>, <code>alchemy_table</code>, ...).</li>
    <li>Choisir la <strong>forme</strong> :
      <ul>
        <li><code>kind: "shaped"</code> + pattern 3Ã—3, ou</li>
        <li><code>kind: "shapeless"</code> (plus tard).</li>
      </ul>
    </li>
    <li>DÃ©finir correctement <code>pattern</code> et <code>legend</code>.</li>
    <li>Fixer <code>required_table_level</code> en cohÃ©rence avec la puissance de lâ€™item.</li>
    <li>Configurer Ã©ventuellement <code>unlock_condition</code> (carte, niveau, quÃªte).</li>
    <li>Placer lâ€™icÃ´ne dans <code>static/assets/img/items/...</code> et rÃ©fÃ©rencer le bon chemin.</li>
    <li>RedÃ©marrer le serveur & vÃ©rifier <code>Loaded X craft item definitions</code>.</li>
    <li>Tester via <code>/api/craft/recipes</code> puis via le popup de craft :</li>
    <li>Drag &amp; drop â†’ bouton Crafte actif â†’ rÃ©sultat & inventaire mis Ã  jour.</li>
  </ul>
</div>

</div> <!-- /container -->
</body>
</html>
