<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Documentation â€” Ajouter un item craftable</title>
<style>
  body {
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin: 0;
    padding: 0;
    background: #f7f7fb;
    line-height: 1.6;
    color: #333;
  }

  header {
    background: #4a6fa5;
    color: white;
    padding: 2rem 1rem;
    text-align: center;
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  }

  h1 {
    margin: 0;
    font-size: 2rem;
  }

  h2 {
    margin-top: 2rem;
    color: #26416b;
  }

  h3 {
    margin-top: 1.5rem;
    color: #375a7f;
  }

  .container {
    max-width: 950px;
    margin: 0 auto;
    padding: 2rem;
  }

  pre {
    background: #272822;
    color: #f8f8f2;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 0.9rem;
  }

  code {
    background: #e8e8e8;
    padding: 2px 4px;
    border-radius: 4px;
  }

  ul {
    margin-left: 1rem;
  }

  .box {
    background: white;
    padding: 1.2rem 1.4rem;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.09);
    margin-bottom: 2rem;
  }

  .important {
    background: #fff7d4;
    border-left: 5px solid #ffcd00;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 5px;
  }

  .tip {
    background: #dff4ff;
    border-left: 5px solid #52baff;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 5px;
  }

  .toc a {
    text-decoration: none;
    color: #375a7f;
  }

  .toc a:hover {
    text-decoration: underline;
  }
</style>
</head>

<body>

<header>
  <h1>Guide complet : Ajouter un item craftable dans LodyLand</h1>
</header>

<div class="container">

<div class="box toc">
  <h2>ğŸ“š Table des matiÃ¨res</h2>
  <ul>
    <li><a href="#principes">0. Principe gÃ©nÃ©ral du systÃ¨me de craft</a></li>
    <li><a href="#id">1. Choisir les identifiants (slug / clÃ©s)</a></li>
    <li><a href="#resources">2. VÃ©rifier les ressources utilisÃ©es par la recette</a></li>
    <li><a href="#craft-yml">3. DÃ©clarer lâ€™item dans <code>craft.yml</code></a></li>
    <li><a href="#icon">4. Ajouter lâ€™icÃ´ne de lâ€™item</a></li>
    <li><a href="#reload">5. RedÃ©marrer lâ€™app & vÃ©rifier le chargement</a></li>
    <li><a href="#api-test">6. Tester via lâ€™API de craft</a></li>
    <li><a href="#ui-test">7. Tester via lâ€™UI (popup de craft)</a></li>
    <li><a href="#exemples">8. Exemples complets (corde, canne Ã  pÃªche, pelle)</a></li>
    <li><a href="#tldr">9. TL;DR â€” Checklist rapide</a></li>
  </ul>
</div>

<!-- ==================== SECTION 0 ==================== -->
<div class="box" id="principes">
<h2>0. ğŸ§ª Principe gÃ©nÃ©ral du systÃ¨me de craft</h2>

<p>Un <strong>item craftable</strong> dans LodyLand est dÃ©fini par :</p>

<ul>
  <li>Une entrÃ©e dans <code>app/data/craft.yml</code> (section <code>items:</code>).</li>
  <li>Une <strong>recette</strong> : pattern + lÃ©gende + localisation (table de craft, plus tard alchimie, etc.).</li>
  <li>Une <strong>icÃ´ne</strong> accessible cÃ´tÃ© frontend.</li>
  <li>(Optionnel) Des stats dâ€™outil (durabilitÃ©, bonus, â€¦).</li>
  <li>(Optionnel) Une condition de dÃ©blocage (carte, niveau, quÃªte, ...).</li>
</ul>

<p>Ensuite :</p>
<ul>
  <li>Le backend charge le YAML â†’ <code>CRAFT_DEFS</code>.</li>
  <li><code>/api/craft/recipes</code> expose les recettes compatibles avec la table actuelle.</li>
  <li>Lâ€™UI (popup de craft) :
    <ul>
      <li>Affiche les recettes via le bouton ğŸ“–.</li>
      <li>DÃ©code la recette en slots.</li>
      <li>Permet de faire du drag &amp; drop des ingrÃ©dients dans la table.</li>
    </ul>
  </li>
</ul>

<div class="important">
Actuellement la <strong>table de craft de base</strong> gÃ¨re une <strong>seule ligne de 3 cases</strong>.<br />
Les recettes doivent donc rester sur un pattern de type <code>"xxx"</code> (width 3, height 1) pour Ãªtre affichÃ©es correctement.
</div>
</div>

<!-- ==================== SECTION 1 ==================== -->
<div class="box" id="id">
<h2>1. ğŸ”¤ Choisir les identifiants de lâ€™item</h2>

<p>Pour chaque nouvel item, on dÃ©finit au minimum :</p>

<ul>
  <li><code>key</code> : identifiant technique unique (stock, API, etc.).</li>
  <li><code>label_fr</code> / <code>label_en</code> : textes affichÃ©s Ã  lâ€™Ã©cran.</li>
  <li><code>type</code> : <code>item</code>, <code>tool</code>, <code>consumable</code>, ...</li>
  <li><code>category</code> : sous-catÃ©gorie (ex: <code>fishing</code>, <code>shovel</code>, <code>material</code>).</li>
</ul>

<p>Exemples de clÃ©s cohÃ©rentes :</p>
<ul>
  <li><code>item_rope</code> â†’ item â€œCordeâ€</li>
  <li><code>tool_improvised_fishing_rod</code> â†’ outil â€œCanne Ã  pÃªche de fortuneâ€</li>
  <li><code>tool_improvised_shovel</code> â†’ outil â€œPelle de fortuneâ€</li>
</ul>

<div class="tip">
Garde une convention stable : <code>item_*</code> pour les items gÃ©nÃ©riques, <code>tool_*</code> pour les outils, etc.  
Ã‡a simplifie la lecture du code et des sauvegardes plus tard.
</div>
</div>

<!-- ==================== SECTION 2 ==================== -->
<div class="box" id="resources">
<h2>2. ğŸŒ¿ VÃ©rifier les ressources utilisÃ©es par la recette</h2>

<p>Avant dâ€™Ã©crire la recette, assure-toi que <strong>les ressources nÃ©cessaires existent</strong> dÃ©jÃ  :</p>

<ul>
  <li>Dans la base (table des ressources).</li>
  <li>Dans la rÃ©ponse de <code>/api/state</code> (section <code>resources</code>).</li>
</ul>

<p>Par exemple, pour une recette utilisant <code>branch</code> et <code>vine</code> :</p>
<ul>
  <li>Le joueur doit pouvoir possÃ©der des ressources <code>branch</code> et <code>vine</code>.</li>
  <li>Dans le JSON de <code>/api/state</code>, tu dois voir quelque chose comme :</li>
</ul>

<pre>
"inventory": [
  { "resource": "branch", "qty": 42, ... },
  { "resource": "vine", "qty": 17, ... }
],
"resources": [
  { "key": "branch", "label": "Branche", "icon": "static/assets/img/resources/branch.png", ... },
  { "key": "vine", "label": "Liane", "icon": "static/assets/img/resources/vine.png", ... }
]
</pre>

<div class="important">
Si une ressource nâ€™existe pas (pas de <code>key</code> dans <code>resources</code>),  
tu peux la crÃ©er dans ton systÃ¨me de ressources (<code>resources.yml</code> ou seed DB) avant de lâ€™utiliser en craft.
</div>
</div>

<!-- ==================== SECTION 3 ==================== -->
<div class="box" id="craft-yml">
<h2>3. ğŸ§¾ DÃ©clarer lâ€™item dans <code>app/data/craft.yml</code></h2>

<p>Structure gÃ©nÃ©rale dans <code>craft.yml</code> :</p>

<pre>
items:
  pearl_necklace:
    key: "item_pearl_necklace"
    ...
  wooden_axe:
    key: "tool_wooden_axe"
    ...
  # ğŸ‘‰ Ajouter les nouveaux items ici
</pre>

<p>Chaque entrÃ©e sous <code>items:</code> suit ce format de base :</p>

<pre>
  my_item_slug:
    key: "item_or_tool_key"
    type: "item"            # ou "tool", "consumable", ...
    category: "category_name"

    label_fr: "Nom en franÃ§ais"
    label_en: "Name in English"

    description_fr: "Description cÃ´tÃ© FR."
    description_en: "Description on EN side."

    icon: "static/assets/img/items/..."  # chemin vers l'icÃ´ne

    stackable: true
    tradable: true
    buyable: false

    # Optionnel : condition de dÃ©blocage
    # unlock_condition:
    #   type: "card"
    #   key: "craft_base"

    recipe:
      craft_location: "craft_table"    # pour lâ€™instant uniquement "craft_table"
      kind: "shaped"
      width: 3
      height: 1

      # pattern = 1 ligne de 3 caractÃ¨res
      # . = vide
      # b = branch
      # v = vine
      pattern:
        - "bvv"

      legend:
        b:
          type: "resource"
          key: "branch"
          quantity: 1
        v:
          type: "resource"
          key: "vine"
          quantity: 1

      output_quantity: 1
      craft_time_seconds: 5
      required_table_level: 1
</pre>

<div class="important">
Actuellement, lâ€™UI de craft ne lit que la <strong>premiÃ¨re ligne de pattern</strong> (max 3 cases).  
Donc prÃ©fÃ¨re des recettes de type <code>width: 3</code> / <code>height: 1</code> avec un seul <code>"xxx"</code>.
</div>
</div>

<!-- ==================== SECTION 4 ==================== -->
<div class="box" id="icon">
<h2>4. ğŸ¨ Ajouter lâ€™icÃ´ne de lâ€™item</h2>

<p>Pour lâ€™icÃ´ne :</p>

<ul>
  <li>Placer le fichier dans <code>app/static/assets/img/items/...</code></li>
  <li>Utiliser ce chemin dans <code>craft.yml</code> :</li>
</ul>

<pre>
icon: "static/assets/img/items/rope.png"
</pre>

<p>Le JS de craft se charge de le transformer en chemin absolu (<code>/static/...</code>) si nÃ©cessaire.  
Tu peux aussi mettre directement :</p>

<pre>
icon: "/static/assets/img/items/rope.png"
</pre>

<div class="tip">
Garde un sous-dossier par type si tu veux Ãªtre organisÃ© :
<ul>
  <li><code>static/assets/img/items/tools/wooden_axe.png</code></li>
  <li><code>static/assets/img/items/tools/improvised_fishing_rod.png</code></li>
  <li><code>static/assets/img/items/rope.png</code></li>
</ul>
</div>
</div>

<!-- ==================== SECTION 5 ==================== -->
<div class="box" id="reload">
<h2>5. â™»ï¸ RedÃ©marrer lâ€™app & vÃ©rifier le chargement</h2>

<p>Une fois le YAML modifiÃ© et les icÃ´nes en place :</p>

<ol>
  <li>ArrÃªte le serveur Flask (CTRL+C).</li>
  <li>Relance <code>python run.py</code>.</li>
  <li>Observe la console :</li>
</ol>

<pre>
Loaded 5 craft item definitions from craft.yml.
</pre>

<p>Le nombre doit avoir augmentÃ© aprÃ¨s lâ€™ajout du nouvel item.</p>

<div class="important">
Si tu restes bloquÃ© Ã  <code>Loaded 2 craft item definitions</code>,  
câ€™est quâ€™il y a un <strong>problÃ¨me de YAML</strong> (indentation, clÃ© mal placÃ©e, etc.).  
Dans ce cas, vÃ©rifier tout ce qui est sous <code>items:</code>.
</div>
</div>

<!-- ==================== SECTION 6 ==================== -->
<div class="box" id="api-test">
<h2>6. ğŸ” Tester la recette via lâ€™API</h2>

<p>Avant de passer par lâ€™UI, tu peux vÃ©rifier que lâ€™API de craft voit bien la recette :</p>

<ul>
  <li>Ouvre <code>http://127.0.0.1:5000/api/craft/recipes?location=craft_table</code> dans ton navigateur.</li>
  <li>Tu dois voir <code>"recipes"</code> avec une entrÃ©e pour ton nouvel item :</li>
</ul>

<pre>
{
  "craft_location": "craft_table",
  "craft_table_level": 1,
  "recipes": [
    {
      "item_key": "item_rope",
      "label_fr": "Corde",
      "icon": "static/assets/img/items/rope.png",
      "recipe": {
        "pattern": ["vvv"],
        "legend": { ... },
        ...
      }
    },
    ...
  ]
}
</pre>

<p>Tu peux aussi tester le craft via <code>curl</code> (avec un joueur connectÃ© via cookie) :</p>

<pre>
curl -X POST http://127.0.0.1:5000/api/craft/perform ^
  -H "Content-Type: application/json" ^
  -d "{ \"item_key\": \"item_rope\", \"craft_location\": \"craft_table\", \"times\": 1 }"
</pre>

<div class="tip">
En cas dâ€™erreur <code>not_enough_resources</code>, la rÃ©ponse inclut les ressources manquantes.  
Lâ€™UI affiche aussi un message rouge avec la liste.
</div>
</div>

<!-- ==================== SECTION 7 ==================== -->
<div class="box" id="ui-test">
<h2>7. ğŸ§ª Tester le nouvel item via lâ€™UI (popup Craft)</h2>

<p>Une fois que lâ€™API remonte bien la recette :</p>

<ol>
  <li>Ouvre le jeu dans le navigateur et connecte-toi avec un joueur.</li>
  <li>Clique sur le bouton rond ğŸ› ï¸ en bas Ã  gauche pour ouvrir le <strong>popup de craft</strong>.</li>
  <li>VÃ©rifie :
    <ul>
      <li>Que tes ressources (ex: <code>Branche</code>, <code>Liane</code>) apparaissent Ã  gauche.</li>
      <li>Que lâ€™icÃ´ne et le nom sont corrects.</li>
    </ul>
  </li>
  <li>Clique sur le bouton ğŸ“– pour ouvrir la liste des <strong>recettes</strong>.</li>
  <li>Trouve ta nouvelle recette (ex: â€œCordeâ€, â€œCanne Ã  pÃªche de fortuneâ€, â€œPelle de fortuneâ€).</li>
  <li>Clique sur la recette :
    <ul>
      <li>La <strong>ligne de 3 slots</strong> affiche les ingrÃ©dients attendus (placeholders).</li>
    </ul>
  </li>
  <li>Fais un drag & drop depuis les ingrÃ©dients (Ã  gauche) vers les slots :
    <ul>
      <li>Si lâ€™ingrÃ©dient est incorrect, le slot clignote en rouge.</li>
      <li>Si tous les slots requis sont correctement remplis, le bouton <strong>Crafte</strong> devient actif.</li>
    </ul>
  </li>
  <li>Choisis une quantitÃ© (champ â€œQuantitÃ©â€) et clique sur Crafte :
    <ul>
      <li>En cas de succÃ¨s : message vert â€œCraft rÃ©ussi: xN â€¦â€.</li>
      <li>Lâ€™inventaire de ressources est mis Ã  jour.</li>
    </ul>
  </li>
</ol>
</div>

<!-- ==================== SECTION 8 ==================== -->
<div class="box" id="exemples">
<h2>8. ğŸ§© Exemples complets</h2>

<h3>8.1. Corde (3Ã— liane)</h3>

<pre>
  rope:
    key: "item_rope"
    type: "item"
    category: "material"

    label_fr: "Corde"
    label_en: "Rope"

    description_fr: "Une corde tressÃ©e Ã  partir de lianes."
    description_en: "A rope braided from vines."

    icon: "static/assets/img/items/rope.png"

    stackable: true
    tradable: true
    buyable: false

    recipe:
      craft_location: "craft_table"
      kind: "shaped"
      width: 3
      height: 1

      # v = vine
      pattern:
        - "vvv"

      legend:
        v:
          type: "resource"
          key: "vine"
          quantity: 1

      output_quantity: 1
      craft_time_seconds: 3
      required_table_level: 1
</pre>

<h3>8.2. Canne Ã  pÃªche de fortune (1Ã— branche + 1Ã— liane)</h3>

<pre>
  improvised_fishing_rod:
    key: "tool_improvised_fishing_rod"
    type: "tool"
    category: "fishing"

    label_fr: "Canne Ã  pÃªche de fortune"
    label_en: "Improvised fishing rod"

    description_fr: "Une canne Ã  pÃªche bricolÃ©e avec des branches et des lianes."
    description_en: "A makeshift fishing rod made from branches and vines."

    icon: "static/assets/img/items/tools/improvised_fishing_rod.png"

    stackable: false
    tradable: true
    buyable: false

    recipe:
      craft_location: "craft_table"
      kind: "shaped"
      width: 3
      height: 1

      # b = branch
      # v = vine
      pattern:
        - "bv."   # 1x branch + 1x vine

      legend:
        b:
          type: "resource"
          key: "branch"
          quantity: 1
        v:
          type: "resource"
          key: "vine"
          quantity: 1

      output_quantity: 1
      craft_time_seconds: 5
      required_table_level: 1
</pre>

<h3>8.3. Pelle de fortune (2Ã— branches + 1Ã— liane)</h3>

<pre>
  improvised_shovel:
    key: "tool_improvised_shovel"
    type: "tool"
    category: "shovel"

    label_fr: "Pelle de fortune"
    label_en: "Improvised shovel"

    description_fr: "Une pelle rudimentaire faite de branches et de lianes."
    description_en: "A crude shovel made from branches and vines."

    icon: "static/assets/img/items/tools/improvised_shovel.png"

    stackable: false
    tradable: true
    buyable: false

    recipe:
      craft_location: "craft_table"
      kind: "shaped"
      width: 3
      height: 1

      # b = branch
      # v = vine
      pattern:
        - "bbv"   # 2x branch + 1x vine

      legend:
        b:
          type: "resource"
          key: "branch"
          quantity: 1
        v:
          type: "resource"
          key: "vine"
          quantity: 1

      output_quantity: 1
      craft_time_seconds: 5
      required_table_level: 1
</pre>
</div>

<!-- ==================== SECTION 9 ==================== -->
<div class="box" id="tldr">
<h2>9. ğŸ§¾ TL;DR â€” Checklist rapide</h2>

<ul>
  <li>âœ… Choisir une <code>key</code> unique (<code>item_*</code>, <code>tool_*</code>, ...).</li>
  <li>âœ… VÃ©rifier que les ressources (<code>branch</code>, <code>vine</code>, ...) existent.</li>
  <li>âœ… Ajouter lâ€™entrÃ©e sous <code>items:</code> dans <code>app/data/craft.yml</code>.</li>
  <li>âœ… Utiliser un pattern compatible avec la table 3 cases : <code>width: 3</code>, <code>height: 1</code>.</li>
  <li>âœ… Placer lâ€™icÃ´ne dans <code>app/static/assets/img/items/...</code> et mettre le bon chemin.</li>
  <li>âœ… RedÃ©marrer Flask â†’ vÃ©rifier <code>Loaded X craft item definitions</code>.</li>
  <li>âœ… VÃ©rifier <code>/api/craft/recipes?location=craft_table</code>.</li>
  <li>âœ… Tester dans lâ€™UI : bouton ğŸ› ï¸ â†’ ğŸ“– â†’ drag & drop â†’ Crafte.</li>
</ul>
</div>

</div> <!-- container -->
</body>
</html>
